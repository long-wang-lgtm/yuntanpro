# 第二阶段需求文档 - 完整全栈测试工具

## 项目概述
一款帮助男性识别潜在风险关系的测试工具，通过科学评估减少情感和经济损失。

**第二阶段定位**：完整前后端项目，实现真实的测试码验证、数据统计和管理功能。

## 项目目标
- 提供精准的捞女特征识别测试
- 支持多对象测试和报告管理
- 实现真实的测试码验证系统
- 提供完善的管理员后台和数据统计
- 确保用户数据安全存储和隐私保护

## 用户角色
### 普通用户
1. 进行测试码验证（真实后端验证）
2. 为多个测试对象创建测试
3. 查看和管理历史测试报告
4. 导出测试结果

### 管理员
1. 生成和管理测试码
2. 查看测试码使用统计
3. 管理用户数据（可选）
4. 查看系统运行状态

## 核心功能需求
### 1. 测试码验证系统（真实验证）
- **功能描述**：用户需通过有效的测试码才能使用测试功能

- **详细需求**：
    - 测试码输入界面，支持复制粘贴
    - 实时后端验证机制
    - 闲鱼购买引导和跳转
    - 已验证测试码的本地缓存
    - 测试码使用次数限制（单码单设备，后端控制）

- **业务流程**：
```text
用户打开网站 → 输入测试码 → 后端验证 → 
验证成功 → 进入测试界面 → 本地标记已验证
验证失败 → 显示错误提示 → 引导购买
```

### 2. 多对象测试管理
- **功能描述**：用户可为不同测试对象创建独立测试报告

- **详细需求**：
    - 测试对象创建界面
        - 对象昵称（可选）
        - 认识时间（可选）
        - 关系状态（可选）
        - 测试日期（自动生成）
    - 测试对象列表展示
        - 按测试时间排序
        - 显示风险等级标识
        - 快速查看和删除功能
    - 对象数量最多20个

- **数据模型**：
```typescript
interface TestSubject {
  id: string;           // 唯一标识
  nickname: string;     // 对象昵称
  createTime: Date;     // 创建时间
  relation: string;     // 关系状态
  riskLevel: string;    // 风险等级
  lastUpdate: Date;     // 最后更新时间
}
```

### 3. 测试流程系统
- **功能描述**：完整的测试问卷流程，每完成一题自动保存，防止数据丢失

- **详细需求**：
    - 基本信息收集（7个问题）
        - 用户个人信息
        - 关系状态信息
        - 经济投入情况
    - 主测试问卷（30个题目）
        - 分4个维度展示
        - 实时进度显示
        - 答案自动保存
        - 支持暂存和续测
    - 测试结果计算
        - 基于权重算法
        - 实时得分预览
        - 风险等级判定

- **测试流程**：
```text
测试码验证 → 填写基本信息（baseinfo） → 逐题作答 → 
实时计算得分 → 生成详细报告 → 自动保存（默认日期时间命名） → 询问是否修改报告名称及备注
```

### 4. 报告管理系统
- **功能描述**：测试报告的存储、查看和管理

- **详细需求**：
    - **报告存储**
        - 使用IndexedDB进行本地存储
    
    - **报告管理**
        - 报告列表视图
            - 按测试时间排序
            - 显示风险等级标识
            - 快速查看和删除功能
        - 详细报告页面
            - 各维度得分分析
            - 关键风险点提示

- **数据模型**：
```typescript
interface TestReport {
  id: string;
  reportName: string;    // 可修改的报告名称
  createTime: Date;      // 测试创建时间
  updateTime: Date;      // 最后修改时间
  riskLevel: string;     // 风险等级
  
  // 可选的对象信息
  subjectInfo?: {
    nickname?: string;     // 对象昵称
    relation?: string;     // 关系状态
    knownDuration?: string; // 认识时间
    meetMethod?: string;   // 认识途径
  };
  
  // 测试数据
  baseInfo: BaseInfoAnswers;  // 用户基本信息
  answers: QuestionAnswers;   // 测试题目答案
  scores: ScoreResult;        // 得分结果
  
  // 分析结果
  analysis: string[];         // 关键分析点
  suggestions: string[];      // 建议措施
}
```

### 5. 管理员后台系统
- **功能描述**：测试码的生成、管理和数据统计

- **详细需求**：
    - **测试码生成**
        - 批量生成功能
        - 自定义前缀设置
        - 生成数量控制
        - 自动去重机制

    - **测试码管理**
        - 列表分页展示
        - 使用状态筛选
        - 搜索和过滤
        - 批量导出功能

    - **使用统计**
        - 总测试次数统计
        - 测试码使用率
        - 简单数据看板
        - 用户行为分析（匿名化）

## 用户体验需求
### 界面设计原则
- 深色主题：保护用户隐私，减少眼部疲劳
- 直观导航：清晰的流程指引和进度提示
- 响应式设计：支持PC和移动端访问
- 数据可视化：使用图表展示测试结果

### 交互设计要求
- 流畅的答题体验，减少操作步骤
- 实时的反馈机制，提升用户信心
- 智能的暂存功能，防止数据丢失
- 简洁的报告展示，突出重点信息

## 技术架构需求（全栈）
### 前端技术栈
```text
React 18 + TypeScript
├── 状态管理: Zustand
├── 路由: React Router v6
├── UI组件: Ant Design
├── 表单处理: React Hook Form
├── 数据可视化: Recharts
├── 本地存储: IndexedDB
├── HTTP客户端: Axios
└── 构建工具: Vite
```

### 后端技术栈
```text
Python Flask
├── 数据库: SQLite（开发）/ PostgreSQL（生产）
├── 认证: JWT
├── API文档: Flask-RESTX
├── 部署: Gunicorn + Nginx
├── 缓存: Redis（可选）
└── 依赖管理: pip + requirements.txt
```

### API接口设计
- **测试码验证接口**：`POST /api/validate-code`
- **测试码管理接口**：`GET/POST /api/codes`
- **数据统计接口**：`GET /api/statistics`
- **用户管理接口**：`GET /api/users`（可选）

## 数据存储方案
### 本地存储：
- **IndexedDB**：测试报告和用户数据
- **localStorage**：用户偏好和临时数据
- **加密存储**：敏感信息的保护

### 服务端存储：
- **测试码信息**：测试码、使用状态、创建时间等
- **使用统计信息**：测试次数、用户行为（匿名）
- **管理员账户信息**：管理员登录凭证

## 安全与隐私需求
### 数据安全
- 本地数据加密存储
- API请求频率限制
- JWT token认证机制
- 敏感数据脱敏处理

### 隐私保护
- 不收集个人身份信息
- 测试数据默认本地化
- 可选的匿名数据分享（用户授权）
- 明确的隐私政策说明

## 非功能性需求
### 性能要求
- 本地数据操作：实时响应
- API响应时间：< 200ms
- 支持离线使用（验证后）

### 兼容性要求
- 浏览器支持：Chrome、Firefox、Safari、Edge
- 移动端适配：iOS、Android主流浏览器，以及微信自带浏览器
- 分辨率适配：1920x1080、1366x768、移动端尺寸

### 可维护性
- 模块化代码结构
- 清晰的文档注释
- 统一的代码规范
- 易于扩展的架构设计

## 部署架构
### 开发环境
- 前端：Vite开发服务器
- 后端：Flask开发服务器
- 数据库：SQLite

### 生产环境
- 前端：Nginx静态文件服务
- 后端：Gunicorn + Flask应用服务器
- 数据库：PostgreSQL
- 缓存：Redis（可选）
- 负载均衡：Nginx反向代理

## 迁移策略
### 从第一阶段迁移
1. **数据迁移**：提供数据导出/导入功能
2. **用户引导**：引导用户重新验证测试码
3. **功能兼容**：确保原有功能正常使用

### 商业化运营升级
- 真实的测试码验证系统
- 完善的数据统计和分析
- 管理员后台管理功能
- 可扩展的用户管理系统

## 扩展性考虑
### 功能扩展
- 多语言支持
- 更多测试模板
- 社交分享功能
- 高级分析报告

### 技术扩展
- 微服务架构
- 分布式存储
- 实时数据分析
- 移动端App开发